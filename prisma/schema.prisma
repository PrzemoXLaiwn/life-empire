// Life Empire - Complete Database Schema
// This schema represents the full game world with 30+ interconnected systems

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ========================================
// ENUMS
// ========================================

enum JobCategory {
  ENTRY_LEVEL
  SKILLED
  PROFESSIONAL
  EXECUTIVE
}

enum EducationLevel {
  NONE
  ELEMENTARY
  HIGH_SCHOOL
  UNIVERSITY
  GRADUATE
  TRADE_SCHOOL
}

enum WorkEthic {
  LAZY
  STANDARD
  HARD_WORKER
  WORKAHOLIC
}

enum CrimeCategory {
  THEFT
  VEHICLE_THEFT
  BURGLARY
  ROBBERY
  ASSAULT
  HACKING
  DRUG_DEALING
  MURDER
}

enum CrimeTier {
  PETTY
  MINOR
  MODERATE
  SERIOUS
  MAJOR
  EXTREME
}

enum UserRole {
  USER
  VIP
  MODERATOR
  ADMIN
  OWNER
}

enum DistrictType {
  DOWNTOWN
  BUSINESS
  RESIDENTIAL
  INDUSTRIAL
  GHETTO
  SUBURBS
  WATERFRONT
}

enum GangRank {
  BOSS
  UNDERBOSS
  CAPO
  SOLDIER
  MEMBER
}

enum GangWarStatus {
  DECLARED
  SKIRMISH
  FINAL_BATTLE
  ENDED
}

enum BusinessType {
  RESTAURANT
  CAR_WASH
  TECH_STARTUP
  CASINO
  NIGHTCLUB
  OFFICE
  RETAIL
  WAREHOUSE
  FACTORY
  CAR_DEALERSHIP
  PAWN_SHOP
  LIQUOR_STORE
  HOTEL
  CONSULTING
  FINANCE
  SERVICES
}

enum DrugType {
  WEED
  COCAINE
  METH
  HEROIN
}

enum VehicleType {
  SEDAN
  SPORTS
  LUXURY
  SUV
  MOTORCYCLE
  TRUCK
}

enum PropertyType {
  APARTMENT
  HOUSE
  MANSION
  PENTHOUSE
  WAREHOUSE
  GARAGE
}

enum WeaponType {
  PISTOL
  RIFLE
  SHOTGUN
  SMG
  SNIPER
  EXPLOSIVE
}

enum ItemType {
  LOCKPICK
  MASK
  HACKING_DEVICE
  DRUGS
  LAPTOP
  FOOD
  ENERGY_DRINK
  FIRST_AID
  BODY_ARMOR
  NIGHT_VISION
}

enum HeistRole {
  LEADER
  HACKER
  GUNMAN
  DRIVER
  LOOKOUT
}

enum HeistStatus {
  PLANNING
  IN_PROGRESS
  SUCCESS
  FAILED
  CANCELLED
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
  LAUNDERED
  BUSINESS_PROFIT
  CRIME_REWARD
  JOB_SALARY
  GANG_PAYOUT
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  BLOCKED
}

enum EventType {
  ECONOMIC
  CRIMINAL
  WORLD
  POLITICAL
}

enum ReportStatus {
  PENDING
  INVESTIGATING
  RESOLVED
  DISMISSED
}

enum ReportPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// ========================================
// CORE MODELS
// ========================================

model User {
  id        String    @id
  email     String    @unique
  role      UserRole  @default(USER)
  banned    Boolean   @default(false)
  bannedAt  DateTime?
  bannedBy  String?
  banReason String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  character Character?

  @@map("users")
}

model Character {
  id       String @id @default(cuid())
  userId   String @unique
  username String @unique
  gender   String @default("male") // male, female, other

  // Basic info
  level      Int @default(1)
  experience Int @default(0)
  xpNeeded   Int @default(100)

  // Financial
  cash        Int @default(1000)
  dirtyCash   Int @default(0)
  bankBalance Int @default(0)

  // Visual
  avatar       String? @default("crown")
  customAvatar String? @map("custom_avatar")

  // Location
  cityId     String?
  districtId String?

  // Health & Energy
  health    Int @default(100)
  maxHealth Int @default(100)
  energy    Int @default(100)
  maxEnergy Int @default(100)

  // Attributes (0-100)
  strength     Int @default(10)
  intelligence Int @default(10)
  charisma     Int @default(10)
  stamina      Int @default(10)

  // Physical Stats - Gym Training (0-100)
  endurance Int @default(10)
  speed     Int @default(10)
  agility   Int @default(10)

  // Criminal Skills (0-100)
  shooting    Int @default(0)
  driving     Int @default(0)
  stealth     Int @default(0)
  lockpicking Int @default(0)
  hacking     Int @default(0)

  // Business Skills (0-100)
  management  Int @default(0)
  negotiation Int @default(0)
  accounting  Int @default(0)
  marketing   Int @default(0)

  // Soft Skills (0-100) - Universal skills for career progression
  communication Int @default(10) // Networking, presentations
  leadership    Int @default(10) // Team management, decision making
  creativity    Int @default(10) // Innovation, problem solving
  timeManagement Int @default(10) @map("time_management") // Efficiency, multitasking

  // Status
  reputation  Int   @default(0)
  heatLevel   Float @default(0)
  mentalState Int   @default(100)
  stress      Int   @default(0)

  // Time tracking
  lastEnergyUpdate DateTime @default(now())
  lastActive       DateTime @default(now())

  // Jail & Death
  inJail        Boolean   @default(false)
  jailReleaseAt DateTime?
  isDead        Boolean   @default(false)
  deathCount    Int       @default(0)

  // Premium
  isPremium    Boolean   @default(false)
  premiumUntil DateTime?

  // Education
  educationLevel    EducationLevel @default(NONE) @map("education_level")
  university        String?        @map("university") // University name
  major             String?        @map("major") // University major
  graduationYear    Int?           @map("graduation_year")
  highSchoolGPA     Float          @default(0) @map("high_school_gpa") // 0-4.0
  universityGPA     Float          @default(0) @map("university_gpa") // 0-4.0

  // Employment
  currentJobId      String?        @map("current_job_id")
  yearsInJob        Float          @default(0) @map("years_in_job") // Decimal years
  workEthic         WorkEthic      @default(STANDARD) @map("work_ethic")
  performanceRating Float          @default(75) @map("performance_rating") // 0-100
  lastPromotion     DateTime?      @map("last_promotion")
  lastSalaryReview  DateTime?      @map("last_salary_review")
  annualSalary      Int            @default(0) @map("annual_salary") // Yearly salary
  lastPaycheck      DateTime?      @map("last_paycheck")

  // Probation & Bad Reference (CV/Interview System)
  onProbation                  Boolean   @default(false) @map("on_probation")
  probationDaysLeft            Int       @default(0) @map("probation_days_left")
  probationPerformanceRequired Int       @default(75) @map("probation_performance_required")
  liedOnResume                 Boolean   @default(false) @map("lied_on_resume")
  badReferenceUntil            DateTime? @map("bad_reference_until")
  
  // Grade System (UK-Style)
  currentGrade              Int   @default(1) @map("current_grade") // 1-4
  monthsInCurrentPosition   Float @default(0) @map("months_in_current_position")
  gradeEligibleDate         DateTime? @map("grade_eligible_date")

  // Current gang
  gangId String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user              User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  city              City?                @relation(fields: [cityId], references: [id])
  district          District?            @relation(fields: [districtId], references: [id])
  currentJob        Job?                 @relation("CurrentJob", fields: [currentJobId], references: [id])
  gang              Gang?                @relation("GangMembers", fields: [gangId], references: [id])
  gangMembership    GangMember?
  ledGang           Gang?                @relation("GangLeader")
  jobHistory        JobHistory[]
  crimeHistory      CrimeHistory[]
  businesses        Business[]
  businessEmployees BusinessEmployee[]
  vehicles          Vehicle[]
  properties        Property[]
  weapons           Weapon[]
  inventory         InventoryItem[]
  ledHeists         Heist[]              @relation("HeistLeader")
  heistParticipants HeistParticipant[]
  arrests           Arrest[]
  transactions      Transaction[]
  stockHoldings     StockHolding[]
  cryptoHoldings    CryptoHolding[]
  sentMessages      Message[]            @relation("SentMessages")
  receivedMessages  Message[]            @relation("ReceivedMessages")
  initiatedFriends  Friendship[]         @relation("Initiator")
  receivedFriends   Friendship[]         @relation("Receiver")
  activityLogs      ActivityLog[]
  notifications     Notification[]
  submittedReports    Report[]                @relation("ReportSubmitter")
  receivedReports     Report[]                @relation("ReportTarget")
  dailyRewards        DailyReward[]
  educationEnrollments EducationEnrollment[]
  performanceReviews  PerformanceReview[]
  workRelationships   WorkRelationship[]
  sideHustles         SideHustle[]
  jobBenefits         JobBenefit[]
  workExpenses        WorkExpense[]

  // Achievement Tracking
  totalWorkHours    Float    @default(0) @map("total_work_hours") // Total hours worked across all jobs
  totalHeists       Int      @default(0) @map("total_heists") // Total heists participated in
  heistsSuccessful  Int      @default(0) @map("heists_successful") // Successful heists
  daysPlayed        Int      @default(1) @map("days_played") // Days since character creation
  lastLoginDate     DateTime @default(now()) @map("last_login_date") // Track daily logins
  loginStreak       Int      @default(1) @map("login_streak") // Consecutive login days

  // Gym Stats & Records
  gymBestScores Json? @default("{}") @map("gym_best_scores") // { treadmill: 2850, benchPress: 2700, ... }
  gymAchievements String[] @default([]) @map("gym_achievements") // Array of achievement IDs
  totalWorkouts Int @default(0) @map("total_workouts")
  perfectWorkouts Int @default(0) @map("perfect_workouts")

  // Social/Friend Comparisons
  friendIds String[] @default([]) @map("friend_ids") // Array of friend user IDs

  @@index([userId])
  @@index([username])
  @@index([cityId])
  @@index([districtId])
  @@index([gangId])
  @@index([currentJobId])
  @@map("characters")
}

// ========================================
// LOCATION MODELS
// ========================================

model City {
  id      String @id @default(cuid())
  name    String @unique
  country String

  description String

  crimeBonus       Int   @default(0)
  businessTaxRate  Float @default(0.20)
  policePresence   Int   @default(50)
  gangActivity     Int   @default(50)

  specializations Json @default("[]")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  districts  District[]
  characters Character[]
  businesses Business[]

  @@map("cities")
}

model District {
  id     String       @id @default(cuid())
  cityId String
  name   String
  type   DistrictType

  dangerLevel    Int @default(50)
  wealthLevel    Int @default(50)
  policePresence Int @default(50)

  allowedBusinessTypes Json @default("[]")

  controllingGangId String?
  contestedBy       Json    @default("[]")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  city              City               @relation(fields: [cityId], references: [id])
  controllingGang   Gang?              @relation("ControlledDistricts", fields: [controllingGangId], references: [id])
  characters        Character[]
  businesses        Business[]
  properties        Property[]
  gangTerritories   GangTerritory[]
  drugOperations    DrugOperation[]
  gangWars          GangWar[]

  @@index([cityId])
  @@index([controllingGangId])
  @@map("districts")
}

// ========================================
// EDUCATION MODELS
// ========================================

model Education {
  id          String         @id @default(cuid())
  name        String         @unique
  type        EducationLevel
  major       String?

  // Requirements
  requiredLevel     Int            @default(0) @map("required_level")
  requiredEducation EducationLevel @default(NONE) @map("required_education")
  requiredGPA       Float          @default(0) @map("required_gpa")
  requiredInt       Int            @default(0) @map("required_int")

  // Cost & Duration
  tuitionCost   Int @default(0) @map("tuition_cost")
  durationYears Int @default(4) @map("duration_years")

  // Benefits
  intelligenceGain Int  @default(0) @map("intelligence_gain")
  charismaGain     Int  @default(0) @map("charisma_gain")
  skillGains       Json @default("{}") @map("skill_gains")

  // Meta
  description String
  isAvailable Boolean @default(true) @map("is_available")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  enrollments EducationEnrollment[]

  @@index([type])
  @@map("education")
}

model EducationEnrollment {
  id          String @id @default(cuid())
  characterId String @map("character_id")
  educationId String @map("education_id")

  enrolledAt   DateTime  @default(now()) @map("enrolled_at")
  graduatedAt  DateTime? @map("graduated_at")
  droppedOut   Boolean   @default(false) @map("dropped_out")
  droppedOutAt DateTime? @map("dropped_out_at")

  currentYear   Int    @default(1) @map("current_year")
  gpa           Float  @default(3.0)
  studyEthic    String @default("STANDARD") @map("study_ethic")
  totalCostPaid Int    @default(0) @map("total_cost_paid")

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  education Education @relation(fields: [educationId], references: [id])

  @@index([characterId])
  @@index([educationId])
  @@map("education_enrollments")
}

// ========================================
// JOB MODELS
// ========================================

model Job {
  id          String      @id @default(cuid())
  title       String
  category    JobCategory
  description String

  // Requirements
  requiredLevel     Int            @default(0) @map("requiredLevel")
  requiredEducation EducationLevel @default(NONE) @map("required_education")
  requiredMajor     String?        @map("required_major")
  requiredSchool    String?        @map("required_school")
  requiredSkills    Json           @default("{}") @map("requiredSkills")
  requiredStats     Json           @default("{}") @map("required_stats")

  // Compensation (YEARLY)
  annualSalary    Int  @map("annual_salary")
  bonusPercentage Int  @default(0) @map("bonus_percentage")
  hourlyRate      Int? @map("hourlyRate") // LEGACY - not used anymore

  // Work details
  energyPerWork     Int  @default(20) @map("energy_per_work")
  stressPerWork     Int  @default(5) @map("stress_per_work")
  experiencePerWork Int  @default(10) @map("experience_per_work")
  skillGains        Json @default("{}") @map("skillGains")

  injuryRisk  Float @default(0) @map("injuryRisk")
  stressLevel Int   @default(5) @map("stressLevel")

  // Progression
  nextJobId         String? @map("nextJobId")
  yearsForPromotion Float   @default(2) @map("years_for_promotion")
  minPerformance    Float   @default(70) @map("min_performance")

  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  nextJob          Job?          @relation("JobProgression", fields: [nextJobId], references: [id])
  previousJobs     Job[]         @relation("JobProgression")
  currentEmployees Character[]   @relation("CurrentJob")
  jobHistory       JobHistory[]
  performanceReviews PerformanceReview[]
  jobBenefits      JobBenefit[]

  @@index([category])
  @@index([requiredLevel])
  @@index([requiredEducation])
  @@map("jobs")
}

model JobHistory {
  id          String   @id @default(cuid())
  characterId String
  jobId       String

  // Legacy fields (for old shift system)
  hoursWorked      Float    @default(0)
  totalPay         Int      @default(0)
  experienceGained Int      @default(0)
  startedAt        DateTime @default(now())
  completedAt      DateTime?

  // New fields (BitLife-style)
  jobTitle          String?   @map("job_title")
  yearsWorked       Float     @default(0) @map("years_worked")
  avgPerformance    Float     @default(0) @map("avg_performance") // Average performance rating
  totalEarnings     Int       @default(0) @map("total_earnings")
  promotionsEarned  Int       @default(0) @map("promotions_earned")
  reasonLeft        String?   @map("reason_left") // "Quit", "Fired", "Promoted"
  leftAt            DateTime? @map("left_at")

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  job       Job       @relation(fields: [jobId], references: [id])

  @@index([characterId])
  @@index([jobId])
  @@index([startedAt])
  @@map("job_history")
}

// Performance Reviews - Quarterly evaluations
model PerformanceReview {
  id          String   @id @default(cuid())
  characterId String   @map("character_id")
  jobId       String   @map("job_id")

  // Review Details
  reviewDate    DateTime @default(now()) @map("review_date")
  quarter       Int      // 1-4
  year          Int

  // Ratings (0-100)
  productivityRating  Int @map("productivity_rating")
  qualityRating       Int @map("quality_rating")
  teamworkRating      Int @map("teamwork_rating")
  punctualityRating   Int @map("punctuality_rating")
  overallRating       Int @map("overall_rating") // Average of above

  // Manager Feedback
  managerNotes    String? @db.Text @map("manager_notes")
  strengths       String? @db.Text // Bullet points of strengths
  improvements    String? @db.Text // Areas to improve

  // Outcomes
  salaryIncrease  Int     @default(0) @map("salary_increase") // Dollar amount
  bonusAwarded    Int     @default(0) @map("bonus_awarded")
  promoted        Boolean @default(false)
  warning         Boolean @default(false) // Performance warning

  // Relations
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  job       Job       @relation(fields: [jobId], references: [id])

  @@index([characterId])
  @@index([jobId])
  @@index([reviewDate])
  @@map("performance_reviews")
}

// Work Relationships - Coworkers, bosses, mentors
model WorkRelationship {
  id          String @id @default(cuid())
  characterId String @map("character_id")

  // Relationship Details
  name         String // NPC name
  role         String // "Coworker", "Manager", "Mentor", "Subordinate"
  department   String?

  // Relationship Quality (-100 to 100)
  relationshipScore Int @default(0) @map("relationship_score")

  // Attributes
  influence       Int @default(50) // How influential they are (0-100)
  helpfulness     Int @default(50) // How helpful they are (0-100)
  competitiveness Int @default(50) // How competitive they are (0-100)

  // Interaction History
  lastInteraction  DateTime? @map("last_interaction")
  totalInteractions Int      @default(0) @map("total_interactions")

  // Benefits
  canMentor        Boolean @default(false) @map("can_mentor") // Can provide skill training
  canRecommend     Boolean @default(false) @map("can_recommend") // Can recommend for promotion
  canNetwork       Boolean @default(false) @map("can_network") // Can introduce to other opportunities

  // Status
  isActive Boolean @default(true) @map("is_active")
  metAt    DateTime @default(now()) @map("met_at")

  // Relations
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([role])
  @@map("work_relationships")
}

// Side Hustles - Freelancing, passive income, side businesses
model SideHustle {
  id          String @id @default(cuid())
  characterId String @map("character_id")

  // Hustle Details
  name        String
  type        String // "Freelance", "Passive", "Gig", "Investment"
  description String

  // Requirements
  requiredSkill      String? @map("required_skill") // Which skill is needed
  requiredSkillLevel Int     @default(0) @map("required_skill_level")
  setupCost          Int     @default(0) @map("setup_cost")

  // Earnings
  minEarnings Int @map("min_earnings") // Per work session
  maxEarnings Int @map("max_earnings")

  // Passive Income (if applicable)
  isPassive         Boolean @default(false) @map("is_passive")
  passiveIncomeRate Int     @default(0) @map("passive_income_rate") // Per day

  // Work Requirements
  energyCost       Int @default(10) @map("energy_cost")
  timeRequirement  Int @default(2) @map("time_requirement") // Hours
  successRate      Int @default(80) @map("success_rate") // 0-100

  // Status
  isActive   Boolean  @default(true) @map("is_active")
  startedAt  DateTime @default(now()) @map("started_at")
  lastWorked DateTime? @map("last_worked")

  // Stats
  totalEarned   Int @default(0) @map("total_earned")
  timesWorked   Int @default(0) @map("times_worked")
  totalHours    Int @default(0) @map("total_hours")

  // Relations
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([type])
  @@map("side_hustles")
}

// Job Benefits - Health insurance, car, gym, etc.
model JobBenefit {
  id          String @id @default(cuid())
  characterId String @map("character_id")
  jobId       String @map("job_id")

  // Benefit Details
  type        String // "Health Insurance", "Dental", "Vision", "401K", "Company Car", "Gym Membership", "Meal Vouchers", "Transit Pass"
  name        String
  description String?

  // Value
  monthlyValue Int @map("monthly_value") // Dollar value equivalent
  costToPlayer Int @default(0) @map("cost_to_player") // What player pays monthly

  // Status
  isActive   Boolean  @default(true) @map("is_active")
  startedAt  DateTime @default(now()) @map("started_at")
  endedAt    DateTime? @map("ended_at")

  // Relations
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  job       Job       @relation(fields: [jobId], references: [id])

  @@index([characterId])
  @@index([jobId])
  @@map("job_benefits")
}

// Work Expenses - Commuting, dress code, meals, etc.
model WorkExpense {
  id          String   @id @default(cuid())
  characterId String   @map("character_id")

  // Expense Details
  type        String   // "Commute", "Parking", "Uniform", "Tools", "Meals", "Dry Cleaning", "Professional Development"
  description String

  // Cost
  amount      Int      // Amount paid
  frequency   String   // "Daily", "Weekly", "Monthly", "One-time"

  // Date
  paidAt      DateTime @default(now()) @map("paid_at")
  relatedToJob String? @map("related_to_job") // Job title/ID

  // Relations
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([paidAt])
  @@map("work_expenses")
}

// ========================================
// CRIME MODELS
// ========================================

model Crime {
  id          String        @id @default(cuid())
  name        String
  category    CrimeCategory
  tier        CrimeTier
  description String

  requiredLevel  Int  @default(0)
  requiredSkills Json @default("{}")
  requiredItems  Json @default("[]")
  crewSize       Json @default("{\"min\": 1, \"max\": 1}")

  duration   Int @default(5)
  energyCost Int @default(10)

  baseSuccessRate Float @default(50)
  skillWeight     Json  @default("{}")

  minReward        Int @default(100)
  maxReward        Int @default(1000)
  experienceReward Int @default(20)

  heatGain     Float @default(0.5)
  heatOnFail   Float @default(1.0)
  arrestChance Float @default(0.3)
  injuryChance Float @default(0)
  deathRisk    Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  crimeHistory CrimeHistory[]

  @@index([category])
  @@index([tier])
  @@index([requiredLevel])
  @@map("crimes")
}

model CrimeHistory {
  id          String  @id @default(cuid())
  characterId String
  crimeId     String

  success          Boolean
  reward           Int     @default(0)
  experienceGained Int     @default(0)
  heatGained       Float   @default(0)

  arrested        Boolean @default(false)
  injured         Boolean @default(false)
  healthLost      Int     @default(0)
  witnessesKilled Int     @default(0)

  committedAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  crime     Crime     @relation(fields: [crimeId], references: [id])

  @@index([characterId])
  @@index([crimeId])
  @@index([committedAt])
  @@map("crime_history")
}

// ========================================
// GANG MODELS
// ========================================

model Gang {
  id       String  @id @default(cuid())
  name     String  @unique
  leaderId String  @unique
  tag      String  @unique

  cash           Int @default(0)
  weeklyIncome   Int @default(0)
  weeklyExpenses Int @default(0)

  reputation  Int     @default(0)
  fear        Int     @default(0)
  memberCount Int     @default(1)

  controlledDistrictIds Json @default("[]")

  isActive  Boolean  @default(true)
  foundedAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  leader              Character       @relation("GangLeader", fields: [leaderId], references: [id])
  members             Character[]     @relation("GangMembers")
  gangMembers         GangMember[]
  controlledDistricts District[]      @relation("ControlledDistricts")
  territories         GangTerritory[]
  attackedWars        GangWar[]       @relation("AttackerGang")
  defendedWars        GangWar[]       @relation("DefenderGang")
  wonWars             GangWar[]       @relation("WinnerGang")
  drugOperations      DrugOperation[]

  @@index([leaderId])
  @@map("gangs")
}

model GangMember {
  id          String   @id @default(cuid())
  gangId      String
  characterId String   @unique
  rank        GangRank

  contributionPoints Int @default(0)
  crimesCommitted    Int @default(0)

  salaryPerWeek Int @default(0)

  joinedAt DateTime @default(now())

  gang      Gang      @relation(fields: [gangId], references: [id], onDelete: Cascade)
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([gangId])
  @@index([characterId])
  @@map("gang_members")
}

model GangTerritory {
  id         String @id @default(cuid())
  gangId     String
  districtId String

  controlPercentage Int     @default(0)
  isContested       Boolean @default(false)

  weeklyProtection Int @default(0)
  weeklyDrugSales  Int @default(0)

  capturedAt DateTime @default(now())

  gang     Gang     @relation(fields: [gangId], references: [id], onDelete: Cascade)
  district District @relation(fields: [districtId], references: [id])

  @@unique([gangId, districtId])
  @@index([gangId])
  @@index([districtId])
  @@map("gang_territories")
}

model GangWar {
  id             String        @id @default(cuid())
  attackerGangId String
  defenderGangId String
  districtId     String
  status         GangWarStatus

  attackerPoints Int @default(0)
  defenderPoints Int @default(0)

  attackerCasualties Int @default(0)
  defenderCasualties Int @default(0)

  startedAt DateTime  @default(now())
  endedAt   DateTime?

  winnerId String?

  attackerGang Gang     @relation("AttackerGang", fields: [attackerGangId], references: [id])
  defenderGang Gang     @relation("DefenderGang", fields: [defenderGangId], references: [id])
  district     District @relation(fields: [districtId], references: [id])
  winner       Gang?    @relation("WinnerGang", fields: [winnerId], references: [id])

  @@index([attackerGangId])
  @@index([defenderGangId])
  @@index([districtId])
  @@index([status])
  @@map("gang_wars")
}

// ========================================
// BUSINESS MODELS
// ========================================

model Business {
  id         String       @id @default(cuid())
  ownerId    String
  cityId     String
  districtId String
  name       String
  type       BusinessType

  investmentCost  Int   @default(0)
  monthlyRevenue  Int   @default(0)
  monthlyExpenses Int   @default(0)
  profitMargin    Float @default(0)

  isOperational Boolean @default(true)
  isLaundering  Boolean @default(false)

  employeeCount Int @default(0)

  innovationPoints Int @default(0)
  researchLevel    Int @default(0)

  marketScore        Int @default(50)
  innovationScore    Int @default(50)
  profitabilityScore Int @default(50)

  openedAt DateTime @default(now())

  owner     Character          @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  city      City               @relation(fields: [cityId], references: [id])
  district  District           @relation(fields: [districtId], references: [id])
  employees BusinessEmployee[]

  @@index([ownerId])
  @@index([cityId])
  @@index([districtId])
  @@index([type])
  @@map("businesses")
}

model BusinessEmployee {
  id          String @id @default(cuid())
  businessId  String
  characterId String

  position String
  salary   Int    @default(0)

  hiredAt DateTime @default(now())

  business  Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([characterId])
  @@map("business_employees")
}

// ========================================
// DRUG OPERATION MODELS
// ========================================

model DrugOperation {
  id         String   @id @default(cuid())
  gangId     String
  districtId String
  drugType   DrugType

  setupCost Int @default(0)
  capacity  Int @default(10)

  currentBatch   Int       @default(0)
  batchStartedAt DateTime?
  batchDuration  Int       @default(24)

  costPerBatch   Int @default(0)
  sellPricePerKg Int @default(0)

  policeRaidRisk  Float @default(0.1)
  rivalAttackRisk Float @default(0.1)

  isActive Boolean @default(true)

  gang      Gang            @relation(fields: [gangId], references: [id], onDelete: Cascade)
  district  District        @relation(fields: [districtId], references: [id])
  inventory DrugInventory[]

  @@index([gangId])
  @@index([districtId])
  @@map("drug_operations")
}

model DrugInventory {
  id              String   @id @default(cuid())
  drugOperationId String
  drugType        DrugType

  quantity Float @default(0)
  quality  Int   @default(50)

  producedAt DateTime @default(now())

  drugOperation DrugOperation @relation(fields: [drugOperationId], references: [id], onDelete: Cascade)

  @@index([drugOperationId])
  @@map("drug_inventory")
}

// ========================================
// VEHICLE & PROPERTY MODELS
// ========================================

model Vehicle {
  id          String      @id @default(cuid())
  characterId String
  model       String
  type        VehicleType

  speed          Int @default(50)
  handling       Int @default(50)
  storage        Int @default(50)
  suspicionLevel Int @default(10)

  condition Int     @default(100)
  isStolen  Boolean @default(false)

  purchasePrice Int
  acquiredAt    DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@map("vehicles")
}

model Property {
  id          String       @id @default(cuid())
  characterId String
  districtId  String
  type        PropertyType

  purchasePrice Int
  monthlyRent   Int @default(0)

  storageCapacity Int     @default(0)
  canHostGangHQ   Boolean @default(false)
  reputationBonus Int     @default(0)

  isRented Boolean @default(false)

  acquiredAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  district  District  @relation(fields: [districtId], references: [id])

  @@index([characterId])
  @@index([districtId])
  @@map("properties")
}

// ========================================
// INVENTORY MODELS
// ========================================

model Weapon {
  id          String     @id @default(cuid())
  characterId String
  name        String
  type        WeaponType

  damage   Int @default(50)
  accuracy Int @default(50)
  fireRate Int @default(50)
  capacity Int @default(10)

  condition Int @default(100)
  ammo      Int @default(0)

  purchasePrice Int
  isLegal       Boolean @default(false)

  acquiredAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@map("weapons")
}

model InventoryItem {
  id          String   @id @default(cuid())
  characterId String
  itemType    ItemType

  quantity Int @default(1)
  quality  Int @default(100)

  acquiredAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@map("inventory_items")
}

// ========================================
// HEIST MODELS
// ========================================

model Heist {
  id         String      @id @default(cuid())
  leaderId   String
  targetType String
  difficulty Int         @default(50)

  planningTime  Int @default(24)
  equipmentCost Int @default(0)
  crewSize      Int @default(4)

  status      HeistStatus
  startedAt   DateTime?
  completedAt DateTime?

  totalLoot    Int  @default(0)
  splitPercent Json @default("{\"leader\": 40}")

  policeResponse Int @default(0)
  casualties     Int @default(0)

  createdAt DateTime @default(now())

  leader       Character          @relation("HeistLeader", fields: [leaderId], references: [id])
  participants HeistParticipant[]

  @@index([leaderId])
  @@index([status])
  @@map("heists")
}

model HeistParticipant {
  id          String    @id @default(cuid())
  heistId     String
  characterId String
  role        HeistRole

  shareAmount Int @default(0)

  joinedAt DateTime @default(now())

  heist     Heist     @relation(fields: [heistId], references: [id], onDelete: Cascade)
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([heistId])
  @@index([characterId])
  @@map("heist_participants")
}

// ========================================
// LEGAL & FINANCE MODELS
// ========================================

model Arrest {
  id          String  @id @default(cuid())
  characterId String
  crimeType   String
  evidence    Int     @default(50)

  sentenceDays Int     @default(1)
  bail         Int     @default(0)
  released     Boolean @default(false)

  arrestedAt DateTime  @default(now())
  releaseAt  DateTime?

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([arrestedAt])
  @@map("arrests")
}

model Transaction {
  id          String          @id @default(cuid())
  characterId String
  type        TransactionType

  amount       Int
  isDirtyMoney Boolean @default(false)
  source       String
  description  String?

  timestamp DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([timestamp])
  @@map("transactions")
}

// ========================================
// MARKET MODELS
// ========================================

model StockHolding {
  id            String @id @default(cuid())
  characterId   String
  companySymbol String

  shares           Int   @default(0)
  avgPurchasePrice Float

  currentValue Float @default(0)

  firstPurchaseAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@unique([characterId, companySymbol])
  @@index([characterId])
  @@map("stock_holdings")
}

model CryptoHolding {
  id          String @id @default(cuid())
  characterId String
  cryptoType  String

  amount           Float
  avgPurchasePrice Float

  currentValue Float @default(0)

  firstPurchaseAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@unique([characterId, cryptoType])
  @@index([characterId])
  @@map("crypto_holdings")
}

// ========================================
// SOCIAL MODELS
// ========================================

model Message {
  id         String  @id @default(cuid())
  senderId   String
  receiverId String
  content    String
  isRead     Boolean @default(false)

  sentAt DateTime @default(now())

  sender   Character @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver Character @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([sentAt])
  @@map("messages")
}

model Friendship {
  id          String           @id @default(cuid())
  initiatorId String
  receiverId  String
  status      FriendshipStatus

  createdAt  DateTime  @default(now())
  acceptedAt DateTime?

  initiator Character @relation("Initiator", fields: [initiatorId], references: [id], onDelete: Cascade)
  receiver  Character @relation("Receiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([initiatorId, receiverId])
  @@index([initiatorId])
  @@index([receiverId])
  @@map("friendships")
}

model ChatMessage {
  id       String @id @default(cuid())
  userId   String
  username String
  avatar   String @default("crown")
  message  String

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("chat_messages")
}

// ========================================
// TRACKING & EVENTS MODELS
// ========================================

model ActivityLog {
  id          String  @id @default(cuid())
  characterId String
  action      String
  details     Json    @default("{}")
  ipAddress   String?

  timestamp DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([timestamp])
  @@map("activity_logs")
}

model RandomEvent {
  id          String    @id @default(cuid())
  eventType   EventType
  name        String
  description String

  effects  Json @default("{}")
  duration Int  @default(24)

  isActive    Boolean   @default(true)
  triggeredAt DateTime  @default(now())
  endsAt      DateTime?

  @@index([isActive])
  @@index([eventType])
  @@map("random_events")
}

model GameEvent {
  id       String @id @default(cuid())
  type     String
  message  String
  userId   String?
  username String?
  avatar   String?

  createdAt DateTime @default(now())

  @@index([type])
  @@index([userId])
  @@index([createdAt])
  @@map("game_events")
}

model Notification {
  id          String  @id @default(cuid())
  characterId String
  type        String
  title       String
  message     String
  isRead      Boolean @default(false)
  link        String?

  createdAt DateTime @default(now())

  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

// ========================================
// MODERATION MODELS
// ========================================

model Report {
  id            String         @id @default(cuid())
  reporterId    String
  targetId      String
  violationType String

  description  String @db.Text
  evidence     String? @db.Text
  incidentDate DateTime

  status   ReportStatus   @default(PENDING)
  priority ReportPriority @default(MEDIUM)

  assignedToModerator String?
  moderatorNotes      String? @db.Text
  resolution          String? @db.Text

  submittedAt DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  resolvedAt  DateTime?

  reporter Character @relation("ReportSubmitter", fields: [reporterId], references: [id], onDelete: Cascade)
  target   Character @relation("ReportTarget", fields: [targetId], references: [id], onDelete: Cascade)

  @@index([reporterId])
  @@index([targetId])
  @@index([status])
  @@index([violationType])
  @@index([submittedAt])
  @@index([priority])
  @@map("reports")
}

model DailyReward {
  id          String   @id @default(cuid())
  characterId String   @map("character_id")
  day         Int
  claimedAt   DateTime @default(now())  // ‚Üê BEZ @map!
  
  character Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  @@unique([characterId, day])
  @@index([characterId])
  @@map("daily_rewards")
}


